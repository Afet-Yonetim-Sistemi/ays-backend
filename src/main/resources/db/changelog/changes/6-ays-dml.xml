<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.10.xsd">

    <changeSet id="6-ays-dml" author="ibrahimdenizz">
        <!-- ========================================== -->
        <!-- DML of AYS_ADMIN_USER_REGISTER_APPLICATION -->
        <!-- ========================================== -->
        <renameTable
                oldTableName="AYS_ADMIN_USER_REGISTER_VERIFICATION"
                newTableName="AYS_ADMIN_USER_REGISTER_APPLICATION"
        />

        <addColumn tableName="AYS_ADMIN_USER_REGISTER_APPLICATION">
            <column name="REJECT_REASON" type="VARCHAR(512)"/>
            <column name="INSTITUTION_ID" type="VARCHAR(36)">
                <constraints foreignKeyName="FK__AYS_ADMIN_USER_REGISTER_APPLICATION__INSTITUTION_ID"
                             referencedTableName="AYS_INSTITUTION"
                             referencedColumnNames="ID"
                />
            </column>
        </addColumn>

        <dropForeignKeyConstraint
                baseTableName="AYS_ADMIN_USER_REGISTER_APPLICATION"
                constraintName="FK__AYS_ADMIN_USER_REGISTER_VERIFICATION__ADMIN_USER_ID"/>
        <addForeignKeyConstraint
                baseColumnNames="ADMIN_USER_ID"
                baseTableName="AYS_ADMIN_USER_REGISTER_APPLICATION"
                constraintName="FK__AYS_ADMIN_USER_REGISTER_APPLICATION__ADMIN_USER_ID"
                referencedColumnNames="ID"
                referencedTableName="AYS_ADMIN_USER"
        />

        <sql>
            ALTER TABLE AYS_ADMIN_USER_REGISTER_APPLICATION DROP CONSTRAINT C__AYS_ADMIN_USER_REGISTER_VERIFICATION__ADMIN_USER_ID;
            ALTER TABLE AYS_ADMIN_USER_REGISTER_APPLICATION
                ADD CONSTRAINT C__AYS_ADMIN_USER_REGISTER_APPLICATION__STATUS CHECK (STATUS IN ('WAITING', 'COMPLETED', 'VERIFIED', 'REJECTED'));
        </sql>

        <update  tableName="AYS_ADMIN_USER_REGISTER_APPLICATION">
            <column name="INSTITUTION_ID" value="77ece256-bf0e-4bbe-801d-173083f8bdcf"/>
            <where>id='3cfeb994-88f4-48d0-b105-309f42f91412'</where>
        </update>
        <!-- ========================================== -->
        <!-- DML of AYS_ADMIN_USER_REGISTER_APPLICATION -->
        <!-- ========================================== -->
    </changeSet>
</databaseChangeLog>
